close all; clear;clc;add_path()N = [20, 20];%% Generate two spheres that are not collide at the mean posesflag = true;while flags1 = SuperQuadrics({0.05*ones(1,3), [1,1], [0, 0]...    zeros(3,1), [1, 0, 0, 0], N});s2 = SuperQuadrics({0.05*ones(1,3), [1,1], [0, 0]...    0.2*rand(3,1), rand(1,4), N});[flag, dist, pt_cls, condition] = collision_cfc(s1,s2,'constrained');endfigure; hold on; axis equal;lightangle(gca,45,30);lighting gouraud;s1.PlotShape('b', 0.4);s2.PlotShape('g', 0.4);m1 = s1.GetGradientsCanonical();mink = MinkSumClosedForm(s1,s2,quat2rotm(s1.q),quat2rotm(s2.q));x_mink = mink.GetMinkSumFromGradient(m1)+s1.tc;X = reshape(x_mink(1,:), N(1), N(2)); %change array to matrix formY = reshape(x_mink(2,:), N(1), N(2));Z = reshape(x_mink(3,:), N(1), N(2));surf(X, Y, Z,... 'EdgeColor', 'k', 'EdgeAlpha', 0.2,... 'FaceAlpha', 0.1, 'FaceColor', 'b'); %plot contact space%% Solve max contact probabilitymu = s2.tc;Sigma = 2.5000e-07*eye(3);mu_g =  [quat2rotm(s2.q), s2.tc; 0, 0, 0, 1];Sigma_g = pi/16*eye(6);Sigma_g(4:6,4:6) = 2.5000e-07*eye(3);%% Using x_max[pdf_max_x, x_max] = max_probability_pure_translation(mu, Sigma, s1, s2);scatter3(x_max(1), x_max(2), x_max(3), "ro")v =  4*pi/3*(s1.a(1)+s2.a(1))^3 ;prob_max_x = v * pdf_max_x;%% Using g_max[pdf_max_g, g_max] = max_contact_probability(mu_g, Sigma_g, s1, s2, false);scatter3(g_max(1,4),g_max(2,4),g_max(3,4),"k+")pkf_value = pkf_3d_sphere(s1, s2);prob_max_g = pkf_value*pdf_max_g;%% Compute exact probability using Mante Carlo methodexact_prob_x = exact_contact_probability_pure_translation(mu, Sigma, s1, s2, 10000)exact_prob_g = exact_contact_probability(mu_g, Sigma_g, s1, s2, 10000)%%% Sample noisy s2 posesn = 100;xi_rand = mvnrnd(mu, Sigma, n);for i = 1:size(xi_rand, 1)       s2.tc = xi_rand(i,1:3)';    s2.PlotShape('r', 0.2);end